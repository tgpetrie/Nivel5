{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2 style="color: #ffffff; margin-bottom: 20px; text-align: center; font-weight: 600;">
        üéß Comprensi√≥n Auditiva
    </h2>
    
    <div style="text-align: center; margin-bottom: 30px;">
        <p style="font-size: 1.2em; color: #e0e0e0; margin-bottom: 20px; font-weight: 300;">
            Ejercicios de comprensi√≥n auditiva basados en texto - Nivel 5 UNAM
        </p>
        <p style="color: #b0b0b0; font-size: 0.9em;">
            Lee el texto del "audio" y responde las preguntas
        </p>
    </div>

    <!-- Audio Comprehension Exercise -->
    <div style="background: rgba(0, 0, 0, 0.3); padding: 25px; border-radius: 15px; margin: 20px 0; border: 1px solid rgba(255, 255, 255, 0.1); max-width: 800px; margin: 0 auto 30px auto;">
        <h3 style="color: #ce1126; margin-bottom: 20px; text-align: center;">üéß Comprensi√≥n Auditiva</h3>
        
        <!-- Audio Script -->
        <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #00d084;">
            <h4 style="color: #00d084; margin-bottom: 15px;">üìª Transcripci√≥n del Audio:</h4>
            <p style="color: #e0e0e0; font-style: italic; line-height: 1.6; font-size: 1.1em;">
                "El s√°bado pasado se llev√≥ a cabo un reto gastron√≥mico muy especial en la UNAM Polanco. 
                Los estudiantes de Nivel 5 participaron en un concurso de cocina fusi√≥n donde ten√≠an que 
                crear un platillo que combinara ingredientes tradicionales mexicanos con t√©cnicas 
                internacionales. El ingrediente principal era el ma√≠z, espec√≠ficamente el ma√≠z azul 
                originario de M√©xico. La creaci√≥n ganadora fue el 'ramen elote azul', una innovadora 
                combinaci√≥n de ramen japon√©s con elote mexicano. Los estudiantes ya hab√≠an subido 
                historias a sus redes sociales documentando todo el proceso antes del evento."
            </p>
        </div>

        <!-- Questions -->
        <div style="display: grid; gap: 20px;">
            <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px;">
                <h4 style="color: #ffffff; margin-bottom: 15px;">Pregunta 1:</h4>
                <p style="color: #e0e0e0; margin-bottom: 15px; font-size: 1.1em;">
                    ¬øD√≥nde se llev√≥ a cabo el reto gastron√≥mico mencionado en el audio?
                </p>
                <input type="text" id="audio1" placeholder="Escribe tu respuesta aqu√≠..." 
                       style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.3); background: rgba(0, 0, 0, 0.3); color: #ffffff; font-size: 1em;">
                <div id="feedback1" style="margin-top: 10px; display: none;"></div>
                <button onclick="checkAudioAnswer(1, 'UNAM Polanco')" 
                        style="margin-top: 10px; padding: 8px 16px; background: #006847; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Verificar Respuesta
                </button>
            </div>

            <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px;">
                <h4 style="color: #ffffff; margin-bottom: 15px;">Pregunta 2:</h4>
                <p style="color: #e0e0e0; margin-bottom: 15px; font-size: 1.1em;">
                    ¬øCu√°l fue el ingrediente principal del plato ganador?
                </p>
                <input type="text" id="audio2" placeholder="Escribe tu respuesta aqu√≠..." 
                       style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.3); background: rgba(0, 0, 0, 0.3); color: #ffffff; font-size: 1em;">
                <div id="feedback2" style="margin-top: 10px; display: none;"></div>
                <button onclick="checkAudioAnswer(2, 'ma√≠z')" 
                        style="margin-top: 10px; padding: 8px 16px; background: #006847; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Verificar Respuesta
                </button>
            </div>

            <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px;">
                <h4 style="color: #ffffff; margin-bottom: 15px;">Pregunta 3:</h4>
                <p style="color: #e0e0e0; margin-bottom: 15px; font-size: 1.1em;">
                    ¬øC√≥mo se llamaba la creaci√≥n ganadora?
                </p>
                <input type="text" id="audio3" placeholder="Escribe tu respuesta aqu√≠..." 
                       style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.3); background: rgba(0, 0, 0, 0.3); color: #ffffff; font-size: 1em;">
                <div id="feedback3" style="margin-top: 10px; display: none;"></div>
                <button onclick="checkAudioAnswer(3, 'ramen elote azul')" 
                        style="margin-top: 10px; padding: 8px 16px; background: #006847; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Verificar Respuesta
                </button>
            </div>

            <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px;">
                <h4 style="color: #ffffff; margin-bottom: 15px;">Pregunta 4:</h4>
                <p style="color: #e0e0e0; margin-bottom: 15px; font-size: 1.1em;">
                    ¬øQui√©nes participaron en el concurso?
                </p>
                <input type="text" id="audio4" placeholder="Escribe tu respuesta aqu√≠..." 
                       style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.3); background: rgba(0, 0, 0, 0.3); color: #ffffff; font-size: 1em;">
                <div id="feedback4" style="margin-top: 10px; display: none;"></div>
                <button onclick="checkAudioAnswer(4, 'estudiantes Nivel 5')" 
                        style="margin-top: 10px; padding: 8px 16px; background: #006847; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Verificar Respuesta
                </button>
            </div>

            <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px;">
                <h4 style="color: #ffffff; margin-bottom: 15px;">Pregunta 5:</h4>
                <p style="color: #e0e0e0; margin-bottom: 15px; font-size: 1.1em;">
                    ¬øQu√© hab√≠an hecho los estudiantes antes del evento?
                </p>
                <input type="text" id="audio5" placeholder="Escribe tu respuesta aqu√≠..." 
                       style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.3); background: rgba(0, 0, 0, 0.3); color: #ffffff; font-size: 1em;">
                <div id="feedback5" style="margin-top: 10px; display: none;"></div>
                <button onclick="checkAudioAnswer(5, 'ya hab√≠an subido historias')" 
                        style="margin-top: 10px; padding: 8px 16px; background: #006847; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Verificar Respuesta
                </button>
            </div>
        </div>

        <!-- Score Display -->
        <div id="scoreDisplay" style="text-align: center; margin-top: 30px; padding: 20px; background: rgba(0, 104, 71, 0.1); border-radius: 10px; border: 1px solid rgba(0, 104, 71, 0.3); display: none;">
            <h3 style="color: #00d084; margin-bottom: 10px;">üèÜ Puntuaci√≥n</h3>
            <p id="scoreText" style="color: #ffffff; font-size: 1.2em; font-weight: 500;"></p>
        </div>
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <a href="/" class="btn" style="font-size: 1.1em; padding: 12px 25px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; text-decoration: none; border-radius: 25px; display: inline-block; transition: all 0.3s ease;">
            ‚Üê Volver a la Gu√≠a de Estudio
        </a>
    </div>
</div>

<style>
audio {
    border-radius: 25px;
    background: rgba(0, 0, 0, 0.3);
}
audio::-webkit-media-controls-panel {
    background: rgba(0, 0, 0, 0.3);
}
audio::-webkit-media-controls-current-time-display,
audio::-webkit-media-controls-time-remaining-display {
    color: #ffffff;
}

input[type="text"]:focus {
    outline: none;
    border-color: #00d084;
    box-shadow: 0 0 10px rgba(0, 208, 132, 0.3);
}

button:hover {
    background: #004d35 !important;
    transform: translateY(-1px);
}

.correct {
    background: rgba(0, 208, 132, 0.2) !important;
    border: 1px solid #00d084 !important;
    color: #00d084 !important;
}

.incorrect {
    background: rgba(206, 17, 38, 0.2) !important;
    border: 1px solid #ce1126 !important;
    color: #ce1126 !important;
}
</style>

<script>
let audioScore = 0;
let totalQuestions = 5;
let answered = [];

function normalizeText(text) {
    return text.toLowerCase()
        .replace(/[√°√†√§√¢]/g, 'a')
        .replace(/[√©√®√´√™]/g, 'e')
        .replace(/[√≠√¨√Ø√Æ]/g, 'i')
        .replace(/[√≥√≤√∂√¥]/g, 'o')
        .replace(/[√∫√π√º√ª]/g, 'u')
        .replace(/[√±]/g, 'n')
        .trim();
}

function checkAudioAnswer(questionNum, correctAnswer) {
    const userInput = document.getElementById(`audio${questionNum}`);
    const feedback = document.getElementById(`feedback${questionNum}`);
    const userAnswer = normalizeText(userInput.value);
    const correct = normalizeText(correctAnswer);
    
    // Don't allow re-answering
    if (answered.includes(questionNum)) {
        return;
    }
    
    const isCorrect = userAnswer.includes(correct) || correct.includes(userAnswer);
    
    if (isCorrect) {
        feedback.innerHTML = `<p style="color: #00d084; font-weight: 500;">‚úÖ ¬°Correcto! "${correctAnswer}"</p>`;
        userInput.classList.add('correct');
        audioScore++;
    } else {
        feedback.innerHTML = `<p style="color: #ce1126; font-weight: 500;">‚ùå Incorrecto. La respuesta correcta es: "${correctAnswer}"</p>`;
        userInput.classList.add('incorrect');
    }
    
    feedback.style.display = 'block';
    userInput.disabled = true;
    answered.push(questionNum);
    
    // Update score display
    updateAudioScore();
}

function updateAudioScore() {
    const scoreDisplay = document.getElementById('scoreDisplay');
    const scoreText = document.getElementById('scoreText');
    
    if (answered.length === totalQuestions) {
        const percentage = Math.round((audioScore / totalQuestions) * 100);
        scoreText.textContent = `${audioScore}/${totalQuestions} (${percentage}%)`;
        scoreDisplay.style.display = 'block';
        
        // Add completion message
        let message = '';
        if (percentage >= 80) {
            message = ' - ¬°Excelente comprensi√≥n auditiva!';
        } else if (percentage >= 60) {
            message = ' - Buen trabajo, sigue practicando.';
        } else {
            message = ' - Necesitas m√°s pr√°ctica con comprensi√≥n auditiva.';
        }
        scoreText.textContent += message;
    }
}
</script>
{% endblock %}
